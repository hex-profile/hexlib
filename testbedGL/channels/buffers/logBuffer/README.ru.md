[EN](README.md) RU

LogBuffer
=========

Обработка ошибок
----------------

Реализация лога записывает свои ошибки во внутреннее состояние ошибки.

Статус ошибки вызывает добавление фиксированного сообщения об ошибке
в конце лога при чтении строк из лога.

Операция `clearLog` очищает также и статус ошибки.

При любом наращивании лога, лог сначала пытается перекачать своё состояние
ошибки как обычное сообщение в конец лога и лишь в случае успеха добавляет данные.

При поглощении другого лога состояние ошибки также поглощается.

После операции поглощаемый дельта-буфер всегда пустой и без ошибки.
Если возникло исключение, ошибка записывается в состояние основного буфера.
Поглощаемый буфер всё равно очищается.

Момент последнего изменения
---------------------------

Лог хранит момент последнего изменения (изначально он неопределён).

Этот момент обновляется при добавлении строк, а также при поглощении другого
лога. В пустом логе момент последнего изменения может быть неопределён.

Момент может быть запрошен из внешнего API, а также используется
в качестве условного момента ошибки при показе внутреннего состояния ошибки.

Память лога
-----------

Лог использует deque<>.

Реализация лога умеет хранить лишь L последних сообщений (например, 2 тыс).
Это нужно, потому что программа может бесконечно спамить в глобальную консоль.
Предел L может быть отключен.

### Базовый буфер

Лог использует deque<>.

Удалось обойтись этими операциями, помимо очевидных:

* `cutToLimit`.
Если не (size <= limit), удаляет избыточные элементы из головы (no-throw).

* `removeFromEnd`.
Удаляет N элементов из конца (no-throw).

* `removeFromBeginningAndAppendAtEnd`.
Удаляет K элементов из начала и добавляет N элементов в конец.
Это одновременная операция, которая позволяет лучше использовать память.
Операция может вызвать исключение, но в случае ошибки буфер остается без изменений.
