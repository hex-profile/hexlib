[EN](README.md) RU

[channels]: ../channels/README.ru.md
[cfg-tree]: ../../shellCommon/cfgVars/cfgTree/README.ru.md
[log-buffer]: ../channels/buffers/logBuffer/README.ru.md
[overlay-buffer]: ../channels/buffers/overlayBuffer/README.ru.md

WORKER
======

Тред WORKER работает независимо от треда GUI и выполняет циклы обработки
модуля алгоритма, которые могут быть долгими.

Сервис WORKER
-------------

Сервис WORKER работает [так же, как и остальные сервисы][channels].

Он принимает на вход такие типы обновлений:

* Запрос завершения.

* Получение сигналов модуля алгоритма типа `ActionBuffer`,
  представляющее собой массив ID-шников произошедших сигналов.

* Обновление параметров дисплея `DisplaySettingsBuffer`.
  Сейчас в нём только желательный размер отладочной картинки,
  который лучше всего соответствует размеру окна.

* Обновление мыши `MousePointerBuffer`. Оно содержит текущую позицию
  мыши внутри отладочной картинки, а также флаги нажатия и отпускания
  кнопок мыши.

* [Обновление][cfg-tree] конфигурационных переменных,
  которое может возникать при редактировании человеком конфигурационного
  файла.

Использование других сервисов
-----------------------------

WORKER может посылать [обновление][cfg-tree] своих конфигурационных
переменных сервису ConfigKeeper.

Каждый цикл обработки WORKER посылает обновления сервису GUI:

* Обновление набора сигналов модуля алгоритма типа `ActionSetBuffer`.
* [Обновление][log-buffer] глобального лога.
* [Обновление][log-buffer] локального лога.
* [Обновление][overlay-buffer] главной отладочной картинки.

Сейчас WORKER обновляет набор сигналов один раз на этапе инициализации,
но в дальнейшем может менять его и в течение циклов обработки.

Реализация WORKER
-----------------

WORKER вызывает тестовый модуль алгоритма, который требует полной поддержки
инструментов GPU-модуля. WORKER реализует её при помощи `MinimalShell`.
Поэтому WORKER владеет экземпляром модуля алгоритма, экземпляром `MinimalShell`,
а также пулом памяти модуля алгоритма.

Класс `Worker`:

* Функция `init` выполняется до запуска треда. Кроме создания `MinimalShell`,
  она обновляет набор сигналов модуля алгоритма.

* Функция `run` это тело треда. Она получает API-шки:
  серверную для своего сервиса, чтобы получать обновления
  и клиентские API-шки для сервисов GUI и ConfigUpdater.
  Также тред получает уже созданный контекст и стрим GPU.
